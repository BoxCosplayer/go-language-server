# URI Generic Syntax (RFC 3986)

URI = Uniform Resource Identifier
\\
This RFC defines generic URI syntax. These notes are only for local-context URIs (like `file` style URIs and relative document references), and ignore web-link-focused details.

## Key Parts that I needed:

- URI structure for local identifiers
- Path rules (absolute vs relative)
- Percent-encoding rules
- Normalization rules for stable comparison

### URI structure (local focus)

URI         = scheme ":" hier-part [ "?" query ] [ "#" fragment ]
\\
relative-ref = relative-part [ "?" query ] [ "#" fragment ]
\\
relative-part = "//" authority path-abempty | path-absolute | path-noscheme | path-empty
\\
Notes:
- A URI-reference can be a full URI or a relative reference.
- Relative references need a base URI to resolve.
- For local document references, `path`, `query`, and `fragment` are often the main parts in use.

### Path rules that matter locally

path          = path-abempty | path-absolute | path-noscheme | path-rootless | path-empty
\\
path-abempty  = *( "/" segment )
path-absolute = "/" [ segment-nz *( "/" segment ) ]
path-noscheme = segment-nz-nc *( "/" segment )
path-rootless = segment-nz *( "/" segment )
path-empty    = 0<pchar>
\\
segment-nz-nc = 1*( unreserved / pct-encoded / sub-delims / "@" )
\\
pchar         = unreserved / pct-encoded / sub-delims / ":" / "@"

Important constraints:
- If authority exists, path must be empty or start with `/`.
- If authority does not exist, path cannot start with `//`.
- In relative-path refs, first segment cannot contain `:` (or it can look like a scheme).

### Percent-Encoding

pct-encoded = "%" HEXDIG HEXDIG
\\
unreserved  = ALPHA / DIGIT / "-" / "." / "_" / "~"

Notes:
- Percent-encode while producing a URI from components.
- Decode only after component parsing, except unreserved chars can be decoded any time.
- Do not encode/decode the same string more than once.
- Use uppercase hex digits in percent-encodings for consistency.

### Relative references and dot-segments

- Relative references resolve against a base URI.
- Dot-segments (`.` and `..`) are handled by the `remove_dot_segments` algorithm.
- Normalizers should remove dot-segments even when they appear in non-relative paths.

### Normalization rules useful for local URI handling

- Scheme is case-insensitive; normalize scheme to lowercase.
- Percent-encoding normalization: decode percent-encoded octets that map to unreserved chars.
- Apply dot-segment removal on paths before comparison or map lookups.

### Local-context note from the RFC

- RFC 3986 says URIs tied to end-user local context should only be used when that context is part of the resource identity.
- Example given in the RFC: `file:///etc/hosts`.

RFC sections used: `1.1.1`, `2.1`, `2.3`, `2.4`, `3.3`, `4.2`, `5.2.4`, `6.2.2.2`, `6.2.2.3`.
