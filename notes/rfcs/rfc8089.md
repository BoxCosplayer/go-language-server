# The "file" URI Scheme (RFC 8089)

`file` URI notes for language-server path normalization (URI <-> filesystem path).
Source: <https://datatracker.ietf.org/doc/html/rfc8089>

used for path normalisation

## Key Parts that I needed:

- Normative `file` URI syntax to parse and emit safely
- Local vs non-local authority handling
- Percent-encoding and text encoding expectations
- Windows drive-letter and UNC mapping rules
- Legacy forms worth accepting for compatibility

### Core syntax (normative, Section 2)

ABNF shape used by this RFC:

- `file-URI = file-scheme ":" file-hier-part`
- `file-hier-part = ( "//" auth-path ) / local-path`
- `auth-path = [ file-auth ] path-absolute`
- `local-path = path-absolute`
- `file-auth = "localhost" / host`

Practical meaning:
- Path is absolute in the RFC-defined forms.
- Authority is optional.
- `localhost` authority is treated the same as no authority.

### Local vs non-local (Section 3)

For local dereference/path conversion, treat a `file` URI as local only when:
- authority is absent, or
- authority is `localhost`, or
- authority is an FQDN that resolves to the current machine.

For non-local authorities, this RFC does not define local filesystem operations.

### Encoding and case rules (Sections 2 and 4)

- Preserve URI case during transport; do not force-case the whole URI.
- Filesystem case behavior is platform-dependent (implementation responsibility).
- For Unicode file names, RFC recommends UTF-8 bytes before percent-encoding.
- Parse components first, then percent-decode path bytes (avoid double decode).

### Windows/DOS mapping relevant to LSP (D.2 + E.2/E.3/E.4)

Normative + compatibility points:
- Drive-letter paths are typically represented as first path segment:
  - `file:///c:/path/to/file`
- Common compatibility form also seen in tools:
  - `file:c:/path/to/file` (nonstandard appendix form)
- Drive-letter comparison on Windows is case-insensitive.
- Legacy drive separator `|` can appear (e.g. `c|`); normalize to `:`.
- UNC host/share canonical URI form is:
  - `file://host.example.com/Share/path/to/file`
- Legacy UNC-in-path forms can appear:
  - `file:////host.example.com/path/to/file`
  - `file://///host.example.com/path/to/file`
- Raw backslashes in URI path are invalid; if encountered, compatibility fix is `\` -> `/` before normal parsing.

### Language-server decisions from this RFC

- Accept `file:///...` and `file://host/...` as primary forms.
- Treat `file://localhost/...` as local.
- Reject or treat as non-local any other authority unless explicitly configured.
- For path conversion, reject query/fragment in file URIs for canonical document identity.
- Decode percent-encoding once, normalize separators per platform, and canonicalize output form when re-emitting URIs.

RFC sections used: `2`, `3`, `4`, `D.2`, `E.2`, `E.2.2`, `E.3`, `E.4`, `B`.
